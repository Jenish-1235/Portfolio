---
import Layout from '../layouts/Layout.astro';
import SocialLinks from '../components/SocialLinks.astro';
import { getPublishedPosts, getProjects, getPapers } from '../lib/notion';
import site from '../data/site.json';

const posts = await getPublishedPosts();
const recentPosts = posts.slice(0, 10);
const projects = await getProjects();
const recentProjects = projects.slice(0, 10);
const papers = await getPapers();
const recentPapers = papers.slice(0, 10);
const { home } = site;
---

<Layout title="Home">
  <div class="home-layout">
    <!-- Left Column: Profile & About -->
    <aside class="left-column">
      <div class="profile-card">
        <img src={site.profileImage} alt={site.name} class="profile-img" />
        <h1 class="profile-name">Hey, I am {site.name.split(' ')[0]}</h1>
        <p class="profile-tagline"><em>{site.tagline}</em></p>
      </div>
      <div class="about-section">
        {site.bio.map((para) => (
          <p set:html={para.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')}></p>
        ))}
      </div>
      <SocialLinks />
    </aside>

    <!-- Right Column: Blog, Projects, Papershelf -->
    <div class="right-column">
      <section class="content-block">
        <h2 class="content-heading">
          {home.recentBlogTitle}
          <span class="content-link">• <a href="/blog">{home.recentBlogArchive} &rarr;</a></span>
        </h2>
        <p class="content-subtitle">{home.recentBlogSubtitle}</p>
        {recentPosts.length > 0 ? (
          <ul class="compact-list">
            {recentPosts.map((post) => (
              <li>
                <span class="date">{new Date(post.date).toLocaleDateString('en-US', { month: 'short', day: '2-digit', year: 'numeric' })}</span>
                <a href={`/blog/${post.slug}`}>{post.title}</a>
              </li>
            ))}
          </ul>
        ) : (
          <p class="empty-message"><em>{home.emptyBlogMessage}</em></p>
        )}
      </section>

      <section class="content-block">
        <h2 class="content-heading">
          {home.recentProjectsTitle}
          <span class="content-link">• <a href="/projects">{home.recentProjectsArchive} &rarr;</a></span>
        </h2>
        <p class="content-subtitle">{home.recentProjectsSubtitle}</p>
        {recentProjects.length > 0 ? (
          <ul class="compact-list">
            {recentProjects.map((project) => (
              <li>
                <span class="date">{new Date(project.date).toLocaleDateString('en-US', { month: 'short', day: '2-digit', year: 'numeric' })}</span>
                <a href={`/projects/${project.slug}`}>{project.title}</a>
              </li>
            ))}
          </ul>
        ) : (
          <p class="empty-message"><em>{home.emptyProjectsMessage}</em></p>
        )}
      </section>

      <section class="content-block">
        <h2 class="content-heading">
          {home.recentPapershelfTitle}
          <span class="content-link">• <a href="/papershelf">{home.recentPapershelfArchive} &rarr;</a></span>
        </h2>
        <p class="content-subtitle">{home.recentPapershelfSubtitle}</p>
        {recentPapers.length > 0 ? (
          <ul class="compact-list">
            {recentPapers.map((paper) => (
              <li>
                <span class="date">{new Date(paper.date).toLocaleDateString('en-US', { month: 'short', day: '2-digit', year: 'numeric' })}</span>
                <a href={`/papershelf/${paper.slug}`}>{paper.title}</a>
              </li>
            ))}
          </ul>
        ) : (
          <p class="empty-message"><em>{home.emptyPapershelfMessage}</em></p>
        )}
      </section>
    </div>
  </div>
</Layout>
